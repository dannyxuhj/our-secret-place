(function($,window,document){'use strict';var paypal=wc_ppec_context.use_checkout_js?window.paypal:window.paypal_sdk;var showError=function(errorMessage,selector){var $container=$('.woocommerce-notices-wrapper, form.checkout');if(!$container||!$container.length){$(selector).prepend(errorMessage);return}else{$container=$container.first()}
$('.woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message').remove();$container.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+errorMessage+'</div>');$container.find('.input-text, select, input:checkbox').trigger('validate').trigger('blur');var scrollElement=$('.woocommerce-NoticeGroup-checkout');if(!scrollElement.length){scrollElement=$container}
if($.scroll_to_notices){$.scroll_to_notices(scrollElement)}else{$('html, body').animate({scrollTop:($container.offset().top-100)},1000)}
$(document.body).trigger('checkout_error')}
var getFundingMethods=function(methods){if(!methods){return undefined}
var paypal_funding_methods=[];$.each(methods,function(index,method_name){var method=paypal.FUNDING[method_name.toUpperCase()];if(method){paypal_funding_methods.push(method)}});return paypal_funding_methods}
var renderCreditMessaging=function(buttonSelector){if('undefined'===typeof wc_ppec_context.credit_messaging||!wc_ppec_context.credit_messaging||'undefined'===typeof paypal.Messages){return}
if('undefined'!=typeof paypal.isFundingEligible&&!paypal.isFundingEligible(paypal.FUNDING.CREDIT)&&!paypal.isFundingEligible(paypal.FUNDING.PAYLATER)){return}
if(0===$(buttonSelector).length){return}
var messagingWrapper=$('<div id="woo-ppec-credit-messaging"></div>').prependTo(buttonSelector).get(0);paypal.Messages(wc_ppec_context.credit_messaging).render(messagingWrapper)}
var render=function(isMiniCart){var prefix=isMiniCart?'mini_cart_':'';var button_size=wc_ppec_context[prefix+'button_size'];var button_layout=wc_ppec_context[prefix+'button_layout'];var button_label=('undefined'!==wc_ppec_context[prefix+'button_label'])?wc_ppec_context[prefix+'button_label']:wc_ppec_context.button_label;var allowed=wc_ppec_context[prefix+'allowed_methods'];var disallowed=wc_ppec_context[prefix+'disallowed_methods'];var selector=isMiniCart?'#woo_pp_ec_button_mini_cart':'#woo_pp_ec_button_'+wc_ppec_context.page;var fromCheckout='checkout'===wc_ppec_context.page&&!isMiniCart;const return_url=wc_ppec_context.return_url;const cancel_url=wc_ppec_context.cancel_url;if(!$(selector).length||$(selector).children().length){return}
var button_args={env:wc_ppec_context.environment,locale:wc_ppec_context.locale,commit:fromCheckout,funding:{allowed:getFundingMethods(allowed),disallowed:getFundingMethods(disallowed),},style:{color:wc_ppec_context.button_color,shape:wc_ppec_context.button_shape,label:button_label,layout:button_layout,size:button_size,branding:!0,tagline:!1,},validate:function(actions){$('#woo_pp_ec_button_product').off('.legacy').on('enable',actions.enable).on('disable',actions.disable)},payment:function(){$('.woocommerce-error',selector).remove();return new Promise(function(resolve,reject){if('product'===wc_ppec_context.page&&!isMiniCart){window.wc_ppec_generate_cart(resolve)}else{resolve()}}).then(function(){var data=$(selector).closest('form').add($('<input type="hidden" name="nonce" /> ').attr('value',wc_ppec_context.start_checkout_nonce)).add($('<input type="hidden" name="from_checkout" /> ').attr('value',fromCheckout?'yes':'no')).serialize();var request_callback=function(response){if(!response.success){var messages=response.data?response.data.messages:response.messages;if('string'===typeof messages){showError(messages)}else{var messageItems=messages.map(function(message){return'<li>'+message+'</li>'}).join('');showError('<ul class="woocommerce-error" role="alert">'+messageItems+'</ul>',selector)}
return null}
return response.data.token};if(!wc_ppec_context.use_checkout_js){return fetch(wc_ppec_context.start_checkout_url,{method:'post',cache:'no-cache',credentials:'same-origin',headers:{'Content-Type':'application/x-www-form-urlencoded',},body:data}).then(function(response){return response.json()}).then(request_callback)}else{return paypal.request({method:'post',url:wc_ppec_context.start_checkout_url,body:data,}).then(request_callback)}})},onAuthorize:function(data,actions){if(fromCheckout){$('form.checkout').append($('<input type="hidden" name="paymentToken" /> ').attr('value',!wc_ppec_context.use_checkout_js?data.orderID:data.paymentToken)).append($('<input type="hidden" name="payerID" /> ').attr('value',data.payerID)).trigger('submit')}else{if(!wc_ppec_context.use_checkout_js){const query_args='?woo-paypal-return=true&token='+data.orderID+'&PayerID='+data.payerID;return actions.redirect(return_url+query_args)}
return actions.redirect()}},onCancel:function(data,actions){if(cancel_url&&'orderID' in data){const query_args='?woo-paypal-cancel=true&token='+data.orderID;return actions.redirect(cancel_url+query_args)}},onError:function(){jQuery(selector).empty();render()},};if(!wc_ppec_context.use_checkout_js){if(!isMiniCart){renderCreditMessaging(selector)}
Object.defineProperty(button_args,'createOrder',Object.getOwnPropertyDescriptor(button_args,'payment'));Object.defineProperty(button_args,'onApprove',Object.getOwnPropertyDescriptor(button_args,'onAuthorize'));delete button_args.style.size;$(selector).addClass('wc_ppec_'+button_size+'_payment_buttons');var args_to_remove=['env','locale','commit','funding','payment','onAuthorize'];args_to_remove.forEach(function(arg){delete button_args[arg]});var disabledFundingSources=getFundingMethods(disallowed);if('undefined'===typeof(disabledFundingSources)||!disabledFundingSources||0===disabledFundingSources.length){paypal.Buttons(button_args).render(selector)}else{paypal.getFundingSources().forEach(function(fundingSource){if(-1!==disabledFundingSources.indexOf(fundingSource)){return}
var buttonSettings={createOrder:button_args.createOrder,onApprove:button_args.onApprove,onError:button_args.onError,onCancel:button_args.onCancel,fundingSource:fundingSource,style:(paypal.FUNDING.PAYPAL===fundingSource)?button_args.style:{layout:button_args.style.layout,shape:button_args.style.shape}};var button=paypal.Buttons(buttonSettings);if(button.isEligible()){button.render(selector)}})}}else{paypal.Button.render(button_args,selector)}};if(wc_ppec_context.page){if('checkout'!==wc_ppec_context.page){render()}
$(document.body).on('updated_cart_totals updated_checkout',render.bind(this,!1))}
$(document.body).on('wc_fragments_loaded wc_fragments_refreshed',function(){var $button=$('.widget_shopping_cart #woo_pp_ec_button_mini_cart');if($button.length){$button.empty();render(!0)}})})(jQuery,window,document)